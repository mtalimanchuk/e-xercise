{% extends 'base.html' %}

{% block exercise_content %}
<p><h3>Sample exercise {{ exercise_link }}</h3></p>
<hr>
<form class="exerciseBg" id={{ exercise_link }}>
  <p>I <input id="task1" autocomplete="off"><input type="submit" name="check-task" value="↵" task_id="task1"> sitting on the chair right now</p>
  <p>They <input id="task2" autocomplete="off"><input type="submit" name="check-task" value="↵" task_id="task2"> playing basketball yesterday</p>

</form>
{% endblock %}

{% block script %}
  <script src="https://unpkg.com/promise-polyfill@7.1.2/dist/polyfill.min.js"></script>
  <script src="https://unpkg.com/whatwg-fetch@2.0.4/fetch.js"></script>
  <script>
    function checkTaskSubmit(event) {
      event.preventDefault();
      let taskId = event.target.getAttribute("task_id");
      let taskAnswer = document.getElementById(taskId).value;
      let payload = {"task_id": taskId, "task_answer": taskAnswer};

      fetch({{ url_for('check')|tojson }}, {
        method: 'POST',
        body: JSON.stringify(payload)
      })
        .then(parseJSON)
        .then(showTaskSubmitResult);
    }
    function parseJSON(response) {
      return response.json();
    }
    function showTaskSubmitResult(data) {
      let input = document.getElementById(data.id);
      if (data.result === true){
        input.style.backgroundColor = '#14ff8f';
      } else {
        input.style.backgroundColor = '#ff939c';
      }
    }

    let submitButtonsArray = document.getElementsByName("check-task");
    submitButtonsArray.forEach(function(element) {
        element.addEventListener('click', checkTaskSubmit)
    })

  </script>
{% endblock %}